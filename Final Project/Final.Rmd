<!-- Replace below with the title of your project -->
### Is Solar Energy A Political Issue


<!-- Replace below with your last and first name -->
#### Tuckman, Jonah


<!-- Enter the code required to load your data in the space below. The data will be loaded but the line of code won't show up in your write up (echo=FALSE) in order to save space-->
```{r echo=FALSE}
setwd('/Users/JonahTuckman/Desktop/Spring2019/Statistics/Statistics-MATH-240/Final Project')
statsData <- read.csv('State RE Generation-Table 1.csv') ## Original dataset with many extra energy types
neededCols <- c("State","Solar") ## Focusing on states and Solar output
statsData <- statsData[neededCols] ## Taking only those columns stated above
## Merging voting history 
Voting <- read.csv("Voting.csv")
statsData <- merge(statsData, Voting, by="State")
write.csv(statsData, "SolarData.csv") ## Writing this new file


statsData <- read.csv("SolarData.csv") ## Reading this new file
statsData['X'] <- NULL ## Deleted unneeded column

replaceCommas<-function(X){
  X<-as.numeric(gsub("\\,", "", X))
}

statsData$Solar <- replaceCommas(statsData$Solar)
statsData <- transform(statsData, Republican = ifelse(statsData$Voting == 'R', 1,0))

### Remove NA values
statsData$Republican[is.na(statsData$Republican)] <- 0
statsData$Solar[is.na(statsData$Solar)] <- 0

# Solar positive column
statsData <- transform(statsData, SolarPositive = ifelse(statsData$Solar > 0, 1, 0))

# New set of solely boolean data
keepers <- c("State", "Republican", "SolarPositive")
BooleanData <- statsData[keepers]
BooleanData[is.na(BooleanData)] <- 0



### Dataset splits based on political affiliation
RepData <- subset(statsData, statsData$Voting == 'R')
DemData <- subset(statsData, statsData$Voting == 'D')

```

<!-- In the remainder of the document, add R code chunks as needed -->

### Introduction:

My research question is whether or not the solar output of each state can be dictated by political afiliation. This question pivoted from the original based on a poor representation of overal data. My initial question that I hoped to explore was whether headquarter location of top 10 (in valuation) american oil companies affected state wide solar output. The hiccup I ran into when exploring this was that over 70% of these companies had their headquarters in Texas. This lead to a poor dataset as there was a low representation in other states. 
After I realized this I pivoted my question to explore whether solar output state wide can see a correlation between positive output and political voting patterns. This is an interesting question because the idea of solar energy is one that is globaly impactful for all states and people, independent of political affiliation. 
Positive aspects include limited reliance on oil (and thus foreign policy implications as the US needs to send less soldiers to wars fought over dictating oil rich regions), climate change reduction (the fossil fuel emissions would be limited if cars, trains, planes and more were running off of solar power rather than currently harmful tendencies), fiscal advantages (government stipends for those who opt into a switch into renewable energy) and many more. I found interest in this question after deciding to work for a company over the summer who works towards using Artificial Inteligence to advance the output and profitability of solar fields. Once understanding this aspect of solar energy I began to wonder whether the aspects still holding us back could be political. 



### Data:
Original Data Set:
https://catalog.data.gov/dataset/energy-generation-by-state-and-technology-2009/resource/bb0da868-f498-4c47-b61f-da217897198f

My initial data was from a 2009 study of Energy Generation by Source and State alongside the results from the 2008 general election by state. 
I initially sliced this Energy Generation csv in order to solely include State and Solar output. This dataset includes all types of energy output (Coal, petrolium, solar, wind, etc) but I decided to limit this study to solely solar output. A thought I had for a later extension of this project would be to broaden the exploration and create a boolean variable for all renewable energy output. This would encompass states who have a positive renewable output that does not include solar, thus making our exploration more accurate. 
Once I had a set of States and Solar output, I pulled data of voting records and merged this into the current dataset by state name. Now my data includes State, Voting History, and Solar output. 
From here I did a variety of things to be used later including splitting into seperate Democratic and Republican sets, adding a boolean variable of Solar Positivity to the original set and adding a boolean variable of Republican to the original set. 


### Exploratory data analysis:

```{r echo=FALSE}

#### Political Affiliation Positive Solar Output Percentage
demSolarNum <- subset(DemData, DemData$Solar>0)
demSolarPerc <- (nrow(demSolarNum) / nrow(DemData) * 100)
sprintf("Democrat Positive Solar Output Percentage:  %f", demSolarPerc)

RepSolarNum <- subset(RepData, RepData$Solar > 0)
RepSolarPerc <-(nrow(RepSolarNum) / nrow(RepData) * 100)
sprintf("Republican Positive Solar Output Percentage:  %f", RepSolarPerc)

```

This shows the percentage of each political party affiliated state that has a positive solar output. 
28.57% of the democratic states have a positive solar output and only 4.35% of the republican states have a positive solar output. This shows a large difference in output based on broken groups.

```{r echo=FALSE}
### Ploting these results
# Barplot of Republicans
countsRep <- table(RepData$SolarPositive == 0, RepData$SolarPositive == 1)
barplot(countsRep, main="Republican Solar Usage", horiz=TRUE,
        xlab = "Number Positive",  ylab = " Positive Solar Output", col = c("darkblue", "red"),
        legend = rownames(countsRep), xlim = c(0, 25), ylim = c(0, 3))

# Barplot of Democrats
countsDem <- table(DemData$SolarPositive == 0, DemData$SolarPositive == 1)
barplot(countsDem, main="Democratic Solar Usage", horiz=TRUE,
        xlab = "Number Positive", ylab = " Positive Solar Output", col = c("darkblue", "red"),
        legend = rownames(countsDem), xlim = c(0, 25), ylim = c(0, 3))
```

In these plots we see the republican portion alongisde the democratic portion on the same horizontal range. This allows us to see the difference in internal to party breakdowns of output. We can see that within each party, a higher portion of democratic states have a positive solar output when compared to that of republican states. 

```{r echo=FALSE}
### Boxplots of combined results, broad results because binary results but do show difference in quartiles between the two
boxplot(BooleanData$SolarPositive ~ BooleanData$Republican, data = BooleanData, main="Party Breakdwon", 
        xlab="0 = Democrat, 1 = Republican", ylab="Solar Output")
```

Although the above boxplot is not the prettiest representation it does share something important. As we know, in a box plot the lower quartile to the upper quartile (the box) show us a range of values that encompas the 25th to the 75th quartiles. Thus this includes the median as well as the middle 50% of values.  
In the boxplot shown above we can see that within the republican portion of this, this middle 50% and the bottom 25% (the bottom 75%) is all at the value 0. The maximum is shown at 1 which indicates that there are indeed republican states that have a positive solar output, but this also indicates that at least 75% of these republican states have no solar output.  
In the democrat boxplot, we see a median at 0, which means that less than 50% of the democrat states have positive solar output, but we see the upper quartile at 1. This indicates that more than 25% of democrat aligned states have a positive solar output. 

```{r echo=FALSE}

##install dependency for inference
#install.packages("GREP2")

#### Confidence intervals 
## Republican Data
# inference(RepData$SolarPositive, type = "ci", est = "mean", method = "simulation", boot_method = "se", success = 1)
## Democratic Data
# inference(DemData$SolarPositive, type = "ci", est = "mean", method = "simulation", boot_method = "se", success = 1)
print("Condifence intervals: ")
print("Republican: 95 % Bootstrap interval = ( -0.0422 , 0.1331 )")
print("Democrat: 95 % Bootstrap interval = ( 0.1195 , 0.4519 )")
```

Printing bootstrap confidence intervals because the knit is having an issue with it right now. Code works but is commented out because it will not convert to knit.  
In this interval we see something very important. In the republican 95% confidence bootstrap interval the confidence range has a negative minumum and includes 0 in the range. Clearly our data could not be negative considering they are boolean responses, but the fact that 0 is included is very important as it shows that we are confident that 0 is in the range of possible values.  
In the democrat data this is not the case, 0 is not in the range thus we are 95% confident that the response is not that there are 0 states with positive output. 

```{r echo=FALSE}


### T Test



t.test(statsData$SolarPositive ~ statsData$Republican, data = statsData)
### P val is less than .05 -> Reject the null. 
### This means that there is a significant different between republicans and democrats with solar output positive 

```


### Inference:

Use theoretical and/or simulation methods to perform a hypothesis test, and also construct a confidence interval. If your data fails some conditions and you cannot use a theoretical method, then you should use simulation. It is your responsibility to figure out the appropriate methodology, and apply all methods that are appropriate.

Don't forget to state hypotheses clearly and check conditions...

### Conclusion:

Write a brief summary of your findings without repeating your statements from earlier. Also include a discussion of what you have learned about your research question and the data you collected. You should also acknowledge limitations of your study and include ideas for possible future research.

